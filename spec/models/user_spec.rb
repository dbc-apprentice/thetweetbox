# == Schema Information
#
# Table name: users
#
#  id           :integer          not null, primary key
#  uid          :string(255)
#  name         :string(255)
#  image_url    :string(255)
#  twitter_name :string(255)
#  auth_token   :string(255)
#  auth_secret  :string(255)
#  created_at   :datetime         not null
#  updated_at   :datetime         not null
#

require 'spec_helper'

describe User do
  it { should have_many :tweets }

  context 'creatiion' do

    it "from omniauth" do
      auth_response = "{\"provider\":\"twitter\",\"uid\":\"398173256\",\"info\":{\"nickname\":\"NatashaTheRobot\",\"name\":\"NatashaTheRobot\",\"location\":\"\",\"image\":\"http://a0.twimg.com/profile_images/1606354121/natashatherobot-eightbit_normal\",\"description\":\"Learning...\",\"urls\":{\"Website\":\"http://natashatherobot.com/\",\"Twitter\":\"http://twitter.com/NatashaTheRobot\"}},\"credentials\":{\"token\":\"398173256-zaA2cBichBOQGskNrNYUjyDYRJkcp62TlHRJdLOo\",\"secret\":\"dS3MfobsW8oIeDyRF1kIcNGa5xHK7rngcKqvRG4\"},\"extra\":{\"access_token\":{\"token\":\"398173256-zaA2cBichBOQGskNrNYUjyDYRJkcp62TlHRJdLOo\",\"secret\":\"dS3MfobsW8oIeDyRF1kIcNGa5xHK7rngcKqvRG4\",\"consumer\":{\"key\":\"6KmZfBk2kSeqA8lgrcQhA\",\"secret\":\"aWdvrK39iyt6ZImJjT4ViiqT03ejPs5uvl15SdBRqCs\",\"options\":{\"signature_method\":\"HMAC-SHA1\",\"request_token_path\":\"/oauth/request_token\",\"authorize_path\":\"/oauth/authenticate\",\"access_token_path\":\"/oauth/access_token\",\"proxy\":null,\"scheme\":\"header\",\"http_method\":\"post\",\"oauth_version\":\"1.0\",\"site\":\"https://api.twitter.com\"},\"http\":{\"address\":\"api.twitter.com\",\"port\":443,\"curr_http_version\":\"1.1\",\"no_keepalive_server\":false,\"close_on_empty_response\":false,\"socket\":null,\"started\":false,\"open_timeout\":30,\"read_timeout\":30,\"continue_timeout\":null,\"debug_output\":null,\"use_ssl\":true,\"ssl_context\":{\"cert\":null,\"key\":null,\"client_ca\":null,\"ca_file\":null,\"ca_path\":null,\"timeout\":null,\"verify_mode\":0,\"verify_depth\":null,\"verify_callback\":null,\"options\":4095,\"cert_store\":null,\"extra_chain_cert\":null,\"client_cert_cb\":null,\"tmp_dh_callback\":null,\"session_id_context\":null,\"session_get_cb\":null,\"session_new_cb\":null,\"session_remove_cb\":null,\"servername_cb\":null},\"enable_post_connection_check\":true,\"compression\":null,\"sspi_enabled\":false,\"ssl_version\":null,\"key\":null,\"cert\":null,\"ca_file\":null,\"ca_path\":null,\"cert_store\":null,\"ciphers\":null,\"verify_mode\":0,\"verify_callback\":null,\"verify_depth\":null,\"ssl_timeout\":null},\"http_method\":\"post\",\"uri\":{\"scheme\":\"https\",\"user\":null,\"password\":null,\"host\":\"api.twitter.com\",\"port\":443,\"path\":\"\",\"query\":null,\"opaque\":null,\"registry\":null,\"fragment\":null,\"parser\":null}},\"params\":{\"oauth_token\":\"398173256-zaA2cBichBOQGskNrNYUjyDYRJkcp62TlHRJdLOo\",\"oauth_token_secret\":\"dS3MfobsW8oIeDyRF1kIcNGa5xHK7rngcKqvRG4\",\"user_id\":\"398173256\",\"screen_name\":\"NatashaTheRobot\"},\"response\":{\"date\":[\"Tue, 07 Aug 2012 19:00:58 GMT\"],\"status\":[\"200 OK\"],\"x-transaction-mask\":[\"a6183ffa5f8ca943ff1b53b5644ef114fc63f271\"],\"expires\":[\"Tue, 31 Mar 1981 05:00:00 GMT\"],\"last-modified\":[\"Tue, 07 Aug 2012 19:00:58 GMT\"],\"x-ratelimit-class\":[\"api_identified\"],\"etag\":[\"\\\"0393ee2e8912f1a38e0d947808c5d8f4\\\"\"],\"x-access-level\":[\"read\"],\"x-ratelimit-limit\":[\"350\"],\"cache-control\":[\"no-cache, no-store, must-revalidate, pre-check=0, post-check=0\"],\"x-runtime\":[\"0.03564\"],\"x-mid\":[\"ed71d3e33a3da1ee2a1c8492218e2c26e2eb55de\"],\"x-frame-options\":[\"SAMEORIGIN\"],\"x-transaction\":[\"789fdbbcc63b0b4f\"],\"content-length\":[\"2017\"],\"x-ratelimit-remaining\":[\"346\"],\"pragma\":[\"no-cache\"],\"x-ratelimit-reset\":[\"1344369173\"],\"content-type\":[\"application/json; charset=utf-8\"],\"set-cookie\":[\"k=10.35.55.138.1344366058256731; path=/; expires=Tue, 14-Aug-12 19:00:58 GMT; domain=.twitter.com\",\"guest_id=v1%3A134436605826056117; domain=.twitter.com; path=/; expires=Fri, 08-Aug-2014 07:00:58 GMT\",\"dnt=; domain=.twitter.com; path=/; expires=Thu, 01-Jan-1970 00:00:00 GMT\",\"lang=en; path=/\",\"lang=en; path=/\",\"lang=en; path=/\",\"twid=u%3D398173256%7Cby7kUGMr7Vny3RPPez%2BgYhOsCeg%3D; domain=.twitter.com; path=/; secure\",\"_twitter_sess=BAh7CToPY3JlYXRlZF9hdGwrCB4bdgI5AToMY3NyZl9pZCIlMjJlYjc1YjY5%250AYjFiZTdlZTYzNjIyZmMzMGRjYmJhODU6B2lkIiUwYTk5NmRkMTg1YjE4ZmUy%250AZjNjYmIzZmVjMjQzMDdlYiIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6%250ARmxhc2g6OkZsYXNoSGFzaHsABjoKQHVzZWR7AA%253D%253D--5834598ccaea68cc43b8cec8b3a2e4d857095228; domain=.twitter.com; path=/; HttpOnly\"],\"vary\":[\"Accept-Encoding\"],\"server\":[\"tfe\"]}},\"raw_info\":{\"profile_sidebar_border_color\":\"FBDBCC\",\"id\":398173256,\"default_profile_image\":false,\"contributors_enabled\":false,\"favourites_count\":0,\"verified\":false,\"geo_enabled\":true,\"id_str\":\"398173256\",\"profile_background_tile\":false,\"location\":\"\",\"profile_image_url\":\"http://a0.twimg.com/profile_images/1606354121/natashatherobot-eightbit_normal\",\"profile_sidebar_fill_color\":\"E7ADBB\",\"utc_offset\":null,\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/1606354121/natashatherobot-eightbit_normal\",\"show_all_inline_media\":false,\"followers_count\":209,\"name\":\"NatashaTheRobot\",\"follow_request_sent\":false,\"notifications\":false,\"screen_name\":\"NatashaTheRobot\",\"protected\":false,\"profile_background_color\":\"383443\",\"default_profile\":false,\"friends_count\":106,\"lang\":\"en\",\"description\":\"Learning...\",\"profile_background_image_url\":\"http://a0.twimg.com/profile_background_images/352802268/xd58ac6f8d557c2ba038382813c1ecfb.png\",\"profile_link_color\":\"5C636D\",\"listed_count\":8,\"profile_use_background_image\":false,\"profile_text_color\":\"4B4A58\",\"profile_background_image_url_https\":\"https://si0.twimg.com/profile_background_images/352802268/xd58ac6f8d557c2ba038382813c1ecfb.png\",\"status\":{\"in_reply_to_status_id_str\":null,\"id_str\":\"232867740149489664\",\"coordinates\":null,\"geo\":null,\"in_reply_to_screen_name\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_status_id\":null,\"contributors\":null,\"retweeted\":false,\"truncated\":false,\"retweet_count\":0,\"in_reply_to_user_id\":null,\"created_at\":\"Tue Aug 07 15:56:10 +0000 2012\",\"possibly_sensitive_editable\":true,\"source\":\"<a href=\\\"http://bufferapp.com\\\" rel=\\\"nofollow\\\">Buffer</a>\",\"id\":232867740149489664,\"possibly_sensitive\":false,\"place\":null,\"favorited\":false,\"text\":\"What's New in Edge #Rails: Cleaner #RESTful Controllers w/ respond_with http://t.co/d5o5pLCE\"},\"is_translator\":false,\"following\":false,\"time_zone\":null,\"url\":\"http://natashatherobot.com/\",\"statuses_count\":772,\"created_at\":\"Tue Oct 25 17:45:13 +0000 2011\"}}}"
      auth =  JSON.parse(auth_response)
      expect {
        User.create_with_omniauth(auth)
        }.should change(User, :count).by(1)
    end
end
